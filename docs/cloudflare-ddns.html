<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<title>jeremy.rm â€“ Cloudflare DDNS</title>
<style>

:root {
	--font-stack-sans: -apple-system, "blinkmacsystemfont", "avenir next", "avenir", "segoe ui", "helvetica neue", "helvetica", "Ubuntu", "roboto", "noto", "arial", sans-serif;
	--font-stack-serif: "iowan old style", "apple garamond", "baskerville", "times new roman", "droid serif", "times", "source serif pro", serif, "apple color emoji", "segoe ui emoji", "segoe ui symbol";
	--font-stack-mono:  "menlo", "consolas", "monaco", "liberation mono", "lucida console", monospace;
}

@media (prefers-color-scheme: dark) {
	:root {
		--background-color: #1e1f21ff;
		--foreground-color: #c1c0c0ff;
		--highlight-foreground-color: #ffffffff;
		--highlight-background-color: #000000ff;
		--link-color: #a3d0ffff;
	}
}

@media (prefers-color-scheme: light) {
	:root {
		--background-color: #fdfdfdff;
		--foreground-color: #404040ff;
		--highlight-foreground-color: #000000ff;
		--highlight-background-color: #ffff0040;
		--link-color: #62afffff;
	}
}

html {
	font-size:  clamp(14px, 1vw, 24px);
}

a {
	color: var(--link-color);
	text-decoration: none;
}

blockquote {
	background-color: var(--highlight-background-color);
	border-radius: 0.5rem;
	margin: 3rem 0rem;
	padding: 1rem;
}

blockquote p {
	font-family: var(--font-stack-sans);
	font-style: italic;
	margin: 0;
}

blockquote span {
	display: block;
	font-style: normal;
	font-weight: bold;
	text-align: right;
}

body {
	background-color:  var(--background-color);
	color: var(--foreground-color);
	font-family: var(--font-stack-serif);
	line-height: 1.25;
	margin: auto;
	max-width: 78ch;
	padding: 1ch;
}

h1, h2, h3, h4, h5, h6 {
	font-family: var(--font-stack-sans);
}

mark {
	background-color: var(--highlight-background-color);
	border-radius:  0.25rem;
	color: var(--highlight-foreground-color);
	padding: 0 0.25rem;
}

</style>
</head>

<body>

<header id="title-block-header">
<nav>
<a href="/">Home</a> &mdash; <a href="/tree">Tree</a>
</nav>
<h1 class="title">Cloudflare DDNS</h1>
</header>

  
  
<p>This is the script I use on my Raspberry Pi to update its Cloudflare A-record from behind the VPN.</p>
<blockquote>
<p>Note: <code>01001010.ddns.net</code> is set by my modem which is <em>not</em> behind the VPN.</p>
</blockquote>
<pre class="shell"><code>#!/bin/bash

# Make certain this script is chmod 700.

# Zone
ZONE=&quot;01001010.net&quot;

# DNS Record - Be sure the record type in step 3 matches the type for this record.
RECORD=&quot;01001010.net&quot;

# API Token - Requires DNS:Edit permission for the above zone, nothing else.
TOKEN=&quot;&lt;API TOKEN HERE&gt;&quot;

# Local IP Address
IP=$(dig +short 01001010.ddns.net)

# Step 1: Get ID for $ZONE. This is shown in the dashboard, but it&#39;s simple to retrieve.
ZONEID=$(curl -s -X GET &quot;https://api.cloudflare.com/client/v4/zones?name=$ZONE&amp;status=active&quot; \
    -H &quot;Authorization: Bearer $TOKEN&quot; \
    -H &quot;Content-Type: application/json&quot; | jq -r &#39;{&quot;result&quot;}[] | .[0] | .id&#39;)

# Step 2: Get ID for $RECORD. This is not shown in the dashboard and must be retrieved via API.
RECORDID=$(curl -s -X GET &quot;https://api.cloudflare.com/client/v4/zones/$ZONEID/dns_records?type=A&amp;name=$RECORD&quot; \
    -H &quot;Authorization: Bearer $TOKEN&quot; \
    -H &quot;Content-Type: application/json&quot; | jq -r &#39;{&quot;result&quot;}[] | .[0] | .id&#39;)

# Step 3: API request to update record.
curl -s -X PUT &quot;https://api.cloudflare.com/client/v4/zones/$ZONEID/dns_records/$RECORDID&quot; \
    -H &quot;Authorization: Bearer $TOKEN&quot; \
    -H &quot;Content-Type: application/json&quot; \
    --data &quot;{\&quot;type\&quot;:\&quot;A\&quot;,\&quot;name\&quot;:\&quot;$RECORD\&quot;,\&quot;content\&quot;:\&quot;$IP\&quot;,\&quot;ttl\&quot;:1,\&quot;proxied\&quot;:true}&quot; | jq</code></pre>

<!--
<hr />
<script src="https://giscus.app/client.js"
        data-repo="jeremy-rm/jeremy-rm.giscus"
        data-repo-id="MDEwOlJlcG9zaXRvcnkzOTg2NDA1MjQ="
        data-category="Giscus"
        data-category-id="DIC_kwDOF8LFjM4B-w_k"
        data-mapping="title"
        data-reactions-enabled="0"
        data-emit-metadata="0"
        data-theme="preferred_color_scheme"
        crossorigin="anonymous"
        async>
</script>
-->

<footer>
<hr />
<p style="font-size: small; font-style: italic;">
	<a href="https://github.com/jeremy-rm/publi.sh" target="_blank">publi.sh</a> &rarr; <a href="https://github.com/jeremy-rm/jeremy-rm.github.io/actions/runs/1167114626" target="_blank">f784b86</a>
</p>
</footer>

</body>
</html>
