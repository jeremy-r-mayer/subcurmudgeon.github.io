<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<title>jeremy.rm â€“ Cloudflare DDNS</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@exampledev/new.css@1.1.2/new.min.css" />
<style>

@keyframes blinker {
  50% {
    opacity: 0;
  }
}

/* -- New.CSS overrides - https://github.com/xz/new.css */

@media (prefers-color-scheme: dark) {
  :root {
    --nc-tx-1:  #d0d0d0;
    --nc-tx-2:  #969696;
    --nc-bg-1:  #2a2a2a;
    --nc-bg-2:  #222222;
    --nc-bg-3:  #101010;
    --nc-lk-1:  #a2d2ff;
    --nc-lk-2:  #3291ff;
    --nc-lk-tx: #ffffff;
    --nc-ac-1:  #ffc10770;
    --nc-ac-tx: #ffdc73;
  }
}

@media (prefers-color-scheme: light) {
  :root {
    --nc-tx-1:  #202020;
    --nc-tx-2:  #808080;
    --nc-bg-1:  #fafafa;
    --nc-bg-2:  #eeeeee;
    --nc-bg-3:  #dadada;
    --nc-lk-1:  #3291ff;
    --nc-lk-2:  #a2d2ff;
    --nc-lk-tx: #ffffff;
    --nc-ac-1:  #ffc10770;
    --nc-ac-tx: #ff2600;
  }
}

:root {
  --nc-font-sans: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
  --nc-font-mono: Consolas, monaco, 'Ubuntu Mono', 'Liberation Mono', 'Courier New', Courier, monospace;
}

a {
  text-decoration: none;
}

code {
  border: none;
  color: var(--nc-ac-tx);
  font-size: 1rem;
  padding: 1px 3px;
}

h1, h2, h3 {
  border-bottom: none;
}

h1.title {
  color: var(--nc-tx-1);
  line-height: 2.5rem;
}

h2.subtitle {
  color: var(--nc-tx-2);
  font-size: 1rem;
  font-style: italic;
  font-weight: bold;
  line-height: 1.25rem;
  padding-top: 0;
}

h1.title + h2.subtitle {
  font-size: large;
  font-style: normal;
  font-weight: bold;
  line-height: 1.5rem;
  padding-top: 0;
}

h6 {
  text-transform: uppercase;
}

hr {
  border: 0;
  border-bottom: 1px dashed var(--nc-bg-3);
  margin: 1rem auto;
}

nav {
  background: var(--nc-bg-2);
}

/* -- Pandoc - https://pandoc.org -- */

p.author {
  font-size: large;
}

p.date {
  font-size: small;
}

/* -- Other - https://sbcn.me -- */

.blink {
  animation: blinker 5s linear infinite;
}

p.sitetitle {
  font-size: large;
  font-weight: bold;
}

p.sitetitle > a {
  color: var(--nc-tx-1);
}

p.sitetitle + div.line-block {
}

</style>
</head>

<body>

<header id="title-block-header">
<p class="sitetitle">
  <a href="/">jeremy.rm &mdash;</a>
</p>
<h1 class="title">Cloudflare DDNS</h1>
</header>

  
  
<p>This is the script I use on my Raspberry Pi to update its Cloudflare A-record from behind the VPN.</p>
<blockquote>
<p>Note: <code>01001010.ddns.net</code> is set by my modem which is <em>not</em> behind the VPN.</p>
</blockquote>
<pre class="shell"><code>#!/bin/bash

# Make certain this script is chmod 700.

# Zone
ZONE=&quot;01001010.net&quot;

# DNS Record - Be sure the record type in step 3 matches the type for this record.
RECORD=&quot;01001010.net&quot;

# API Token - Requires DNS:Edit permission for the above zone, nothing else.
TOKEN=&quot;&lt;API TOKEN HERE&gt;&quot;

# Local IP Address
IP=$(dig +short 01001010.ddns.net)

# Step 1: Get ID for $ZONE. This is shown in the dashboard, but it&#39;s simple to retrieve.
ZONEID=$(curl -s -X GET &quot;https://api.cloudflare.com/client/v4/zones?name=$ZONE&amp;status=active&quot; \
    -H &quot;Authorization: Bearer $TOKEN&quot; \
    -H &quot;Content-Type: application/json&quot; | jq -r &#39;{&quot;result&quot;}[] | .[0] | .id&#39;)

# Step 2: Get ID for $RECORD. This is not shown in the dashboard and must be retrieved via API.
RECORDID=$(curl -s -X GET &quot;https://api.cloudflare.com/client/v4/zones/$ZONEID/dns_records?type=A&amp;name=$RECORD&quot; \
    -H &quot;Authorization: Bearer $TOKEN&quot; \
    -H &quot;Content-Type: application/json&quot; | jq -r &#39;{&quot;result&quot;}[] | .[0] | .id&#39;)

# Step 3: API request to update record.
curl -s -X PUT &quot;https://api.cloudflare.com/client/v4/zones/$ZONEID/dns_records/$RECORDID&quot; \
    -H &quot;Authorization: Bearer $TOKEN&quot; \
    -H &quot;Content-Type: application/json&quot; \
    --data &quot;{\&quot;type\&quot;:\&quot;A\&quot;,\&quot;name\&quot;:\&quot;$RECORD\&quot;,\&quot;content\&quot;:\&quot;$IP\&quot;,\&quot;ttl\&quot;:1,\&quot;proxied\&quot;:true}&quot; | jq</code></pre>


<hr />
<p style="font-size: small; font-style: italic;">
	<a href="https://www.github.com/jeremy-rm/publi.sh" target="_blank">publi.sh</a> &rarr; <a href="https://github.com/jeremy-rm/jeremy-rm.github.io/actions/runs/1032043493" target="_blank">9c2a8cb</a>
</p>

</body>
</html>
